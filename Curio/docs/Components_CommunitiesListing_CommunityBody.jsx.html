<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Components/CommunitiesListing/CommunityBody.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Components/CommunitiesListing/CommunityBody.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Listing from "./Listing";
import "./CommunityPage.css";
import Post from "../Post/Post";
import React from 'react';
import { useNavigate } from "react-router-dom";
import { Button } from "@chakra-ui/react";
import { useParams } from 'react-router-dom'
import { fetchDataFromBackend } from "./CommunityEndPoints";
import { fetchNewFromBackend, fetchRisingFromBackend,fetchTopFromBackend,fetchTopTimeFromBackend,fetchSubCurioInfo} from "./CommunityEndPoints";
/**
 * Renders the body of the community page.
 *
 * @param {Object} props - The component props.
 * @returns {JSX.Element} The rendered component.
 */
function CommunityBody(props) {
  const navigate = useNavigate();

  const[posts, setPosts] = React.useState([])
  const [didVote, setDidVote] = React.useState(false);
  const[randomPost, setRandomPost] = React.useState({
    post:{

    },
    isSelected: false
  })
  const { Community } = useParams();
  const[isMod,setIsMod] = React.useState(false);



React.useEffect(() => {
    async function fetchAndSetData() {
        const data = await fetchDataFromBackend(Community);
        if (data) {
            setPosts(data.posts);
            setRandomPost({ ...randomPost, isSelected: false });
        }
    }

    fetchAndSetData();
}, [Community]);

React.useEffect(() => {
  async function fetchAndSetData() {
      const subCurioData = await fetchSubCurioInfo(Community);
      
      if (subCurioData) {
          subCurioData.subreddit.moderators.map((mod)=>{
            
            if(mod.username===localStorage.getItem('username')){
              setIsMod(true);
              return;
            }
            else{
              setIsMod(false);
            }
          })
      }
  }

  fetchAndSetData();
}, [Community]);

function handleCreatePost(){
  props.setSubreddit(Community);
  navigate(`/user/CreatePost`);
}

async function changeSortType(value,time) {
    
    
    
        if (value === 'Hot') {
            const data = await fetchDataFromBackend(Community);
            if (data) {
                setPosts(data.posts);
                setRandomPost({ ...randomPost, isSelected: false });
            }
            else{
              setPosts([]);
              setRandomPost({ ...randomPost, isSelected: false });
            }
        }
        else if (value === 'New') {
            const data = await fetchNewFromBackend(Community);
            if (data) {
                setPosts(data.posts);
                setRandomPost({ ...randomPost, isSelected: false });
            }
            else{
              setPosts([]);
              setRandomPost({ ...randomPost, isSelected: false });
            }
        }
        else if (value === 'Top') {
          if(time==="All Time"){
            const data = await fetchTopFromBackend(Community);
            if (data) {
              setPosts(data.topPosts);
              setRandomPost({ ...randomPost, isSelected: false });
          }
          else{
            setPosts([]);
            setRandomPost({ ...randomPost, isSelected: false });
          }
          }
          else{
            const data = await fetchTopTimeFromBackend(Community,time);
            if (data) {
              setPosts(data.posts);
              setRandomPost({ ...randomPost, isSelected: false });
              }
              else{
                setPosts([]);
                setRandomPost({ ...randomPost, isSelected: false });
              }
            }
            
        }
        else if (value === 'Random') {
            const data = await fetchRisingFromBackend(Community);
            if (data) {
                // setRandomPost({ post: data.post, isSelected: true });
                setPosts(data.post);
                setRandomPost({ ...randomPost, isSelected: false });
            }
            else{
              // setRandomPost({ post:{}, isSelected: true });
              setPosts([]);
              setRandomPost({ ...randomPost, isSelected: false });
            }
        }
    
}

React.useEffect(() => {
  if (localStorage.getItem('token')) {
    if (posts) {
      const votes = [];
      posts.forEach(post => {
        votes[post._id] = post.details?.pollVote !== null;
      });
      setDidVote(votes);
    }
  }
}, [posts]);


  return (
    &lt;div className="community-body">
      &lt;div className=" list mb-3">
        &lt;Listing onChangeSort={changeSortType} isCommunity={true} isProfile={false} isHome={false} />
      &lt;/div>
      &lt;h3 className="headings-titles text-uppercase fw-bold mb-1">&lt;/h3>

      &lt;div className="post">
        {randomPost.isSelected==false ? (posts.map((post) => (
          &lt;>
          {post.type === 'poll' ? (
                    &lt;Post
                    pollTitle={post.title}
                    body={post.body}
                    pollText={post.content}
                    user={post.authorName}
                    _id={post._id}
                    type={post.type}
                    optionNames={post.options.map((option) => option.name)}
                    votes={post.options.map((option) => option.votes)}
                    upvotes={post.upvotes}
                    downvotes={post.downvotes}
                    comments={post.comments}
                    voteLength={post.voteLength}
                    isLocked={post.isLocked}
                    linkedSubreddit={Community}
                    subreddit={Community}
                    optionSelected={post.details?.pollVote}
                    pollEnded={post.details?.pollEnded}
                    didVote={didVote[post._id]}
                    createdAt={post.createdAt}
                  />) : (
                    &lt;Post
                    _id={post._id}
                    title={post.title}
                    body={post.body}
                    user={post.authorName}
                    upvotes={post.upvotes}
                    downvotes={post.downvotes}
                    comments={post.comments}
                    content={post.content}
                    isMod={isMod}
                    linkedSubreddit={Community}
                    isLocked={post.isLocked}
                    subreddit={Community}
                  />
                  )}
          &lt;h3 className="headings-titles text-uppercase fw-bold mb-1">&lt;/h3>
          &lt;/>
        ))):(
          &lt;>
 {randomPost.post.type === 'poll' ? (
                    &lt;Post
                    pollTitle={randomPost.post.title}
                    body={randomPost.post.body}
                    pollText={randomPost.post.content}
                    user={randomPost.post.authorName}
                    _id={randomPost.post._id}
                    type={randomPost.post.type}
                    optionNames={randomPost.post.options.map((option) => option.name)}
                    votes={randomPost.post.options.map((option) => option.votes)}
                    upvotes={randomPost.post.upvotes}
                    downvotes={randomPost.post.downvotes}
                    comments={randomPost.post.comments}
                    linkedSubreddit={Community}
                    voteLength={randomPost.post.voteLength}
                    isLocked={randomPost.post.isLocked}
                    subreddit={Community}
                    optionSelected={randomPost.post.details?.pollVote}
                    pollEnded={randomPost.post.details?.pollEnded}
                    didVote={didVote[randomPost.post._id]}
                    createdAt={randomPost.post.createdAt}
                  />) : (
                    &lt;Post
                    _id={randomPost.post._id}
                    title={randomPost.post.title}
                    body={randomPost.post.body}
                    user={randomPost.post.authorName}
                    upvotes={randomPost.post.upvotes}
                    downvotes={randomPost.post.downvotes}
                    comments={randomPost.post.comments}
                    content={randomPost.post.content}
                    isMod={isMod}
                    linkedSubreddit={Community}
                    isLocked={randomPost.post.isLocked}
                    subreddit={Community}
                  />
                  )}
        &lt;/>
        )}
        {(posts.length&lt;1 &amp;&amp; randomPost.isSelected==false) ||(!randomPost.post &amp;&amp; randomPost.isSelected==true)? (&lt;div className="m-5 row justify-content-center align-items-center">
          &lt;div className="col text-center">
          &lt;h4 className="fw-bold" >This community doesn't have any posts yet&lt;/h4>
          &lt;p className="text-muted">Make one and get this feed started.&lt;/p>
          &lt;Button onClick={handleCreatePost} colorScheme="blue" fontSize='sm' fontWeight='bold' style={{borderRadius:'30px'}} >Create a post&lt;/Button>
          &lt;/div>
          &lt;/div>):null}
      &lt;/div>
      
    &lt;/div>
  );
}
export default CommunityBody;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-AboutDrawer.html">AboutDrawer</a></li><li><a href="module-Activity.html">Activity</a></li><li><a href="module-Advanced.html">Advanced</a></li><li><a href="module-ApproveRemovedPosts.html">ApproveRemovedPosts</a></li><li><a href="module-Block.html">Block</a></li><li><a href="module-BlockUserPage.html">BlockUserPage</a></li><li><a href="module-ChooseCommunity.html">ChooseCommunity</a></li><li><a href="module-CleanQueue.html">CleanQueue</a></li><li><a href="module-CommentInputForm.html">CommentInputForm</a></li><li><a href="module-Community.html">Community</a></li><li><a href="module-CommunityDetails.html">CommunityDetails</a></li><li><a href="module-CommunityRules.html">CommunityRules</a></li><li><a href="module-CreateCommunity.html">CreateCommunity</a></li><li><a href="module-CreatePost.html">CreatePost</a></li><li><a href="module-CreatePostArea.html">CreatePostArea</a></li><li><a href="module-CurioInput.html">CurioInput</a></li><li><a href="module-DisplayFriendInformation.html">DisplayFriendInformation</a></li><li><a href="module-EditCreatearea.html">EditCreatearea</a></li><li><a href="module-FetchUnmoderatedPosts.html">FetchUnmoderatedPosts</a></li><li><a href="module-FollowUserPopover.html">FollowUserPopover</a></li><li><a href="module-FollowersPage.html">FollowersPage</a></li><li><a href="module-FromMessage.html">FromMessage</a></li><li><a href="module-Gender.html">Gender</a></li><li><a href="module-GetBlockedUsers.html">GetBlockedUsers</a></li><li><a href="module-GetFollowers.html">GetFollowers</a></li><li><a href="module-GetFollowersofUser.html">GetFollowersofUser</a></li><li><a href="module-HandleBlockUser.html">HandleBlockUser</a></li><li><a href="module-HandleUnblockUser.html">HandleUnblockUser</a></li><li><a href="module-HeaderChatRightSide.html">HeaderChatRightSide</a></li><li><a href="module-ImageVideo.html">ImageVideo</a></li><li><a href="module-InboxTabs.html">InboxTabs</a></li><li><a href="module-InviteDrawer.html">InviteDrawer</a></li><li><a href="module-Link.html">Link</a></li><li><a href="module-LiveChat.html">LiveChat</a></li><li><a href="module-MarkAsNSFW.html">MarkAsNSFW</a></li><li><a href="module-MessageContent.html">MessageContent</a></li><li><a href="module-Messages.html">Messages</a></li><li><a href="module-MessagesNavbar.html">MessagesNavbar</a></li><li><a href="module-ModQueuePage.html">ModQueuePage</a></li><li><a href="module-ModerationApprovePost.html">ModerationApprovePost</a></li><li><a href="module-ModerationEditedPage.html">ModerationEditedPage</a></li><li><a href="module-ModerationFetchEditedPosts.html">ModerationFetchEditedPosts</a></li><li><a href="module-ModerationFetchRemovedPosts.html">ModerationFetchRemovedPosts</a></li><li><a href="module-ModerationHeader.html">ModerationHeader</a></li><li><a href="module-ModerationRemovePost.html">ModerationRemovePost</a></li><li><a href="module-ModerationRemovedPage.html">ModerationRemovedPage</a></li><li><a href="module-ModerationRemovedPosts.html">ModerationRemovedPosts</a></li><li><a href="module-ModerationSidebar.html">ModerationSidebar</a></li><li><a href="module-ModerationUnmoderatedPage.html">ModerationUnmoderatedPage</a></li><li><a href="module-Mute.html">Mute</a></li><li><a href="module-Navbar.html">Navbar</a></li><li><a href="module-NewChat.html">NewChat</a></li><li><a href="module-NewPostForm.html">NewPostForm</a></li><li><a href="module-NotificationSetting.html">NotificationSetting</a></li><li><a href="module-Notifications.html">Notifications</a></li><li><a href="module-NotificationsDropdown.html">NotificationsDropdown</a></li><li><a href="module-NotificationsEndPoints.html">NotificationsEndPoints</a></li><li><a href="module-NotificationsFunctions.html">NotificationsFunctions</a></li><li><a href="module-NotificationsPage.html">NotificationsPage</a></li><li><a href="module-OpenChat.html">OpenChat</a></li><li><a href="module-OpenChatComLeftSide.html">OpenChatComLeftSide</a></li><li><a href="module-PollInfo.html">PollInfo</a></li><li><a href="module-Polls.html">Polls</a></li><li><a href="module-PollsVoting.html">PollsVoting</a></li><li><a href="module-Pollvotes.html">Pollvotes</a></li><li><a href="module-Post.html">Post</a></li><li><a href="module-PostComments.html">PostComments</a></li><li><a href="module-PostComponent.html">PostComponent</a></li><li><a href="module-PostContentDetails.html">PostContentDetails</a></li><li><a href="module-PostControl.html">PostControl</a></li><li><a href="module-PostMethods.html">PostMethods</a></li><li><a href="module-PostReplies.html">PostReplies</a></li><li><a href="module-PostRepliesCom.html">PostRepliesCom</a></li><li><a href="module-PostingCards.html">PostingCards</a></li><li><a href="module-PostingRules.html">PostingRules</a></li><li><a href="module-Preferences.html">Preferences</a></li><li><a href="module-PrivateMessages.html">PrivateMessages</a></li><li><a href="module-ProfileCategory.html">ProfileCategory</a></li><li><a href="module-ProfileImageUpload.html">ProfileImageUpload</a></li><li><a href="module-ProfileInformation.html">ProfileInformation</a></li><li><a href="module-ProfileSettingPage.html">ProfileSettingPage</a></li><li><a href="module-RecentPosts.html">RecentPosts</a></li><li><a href="module-ReportExtraReason.html">ReportExtraReason</a></li><li><a href="module-ReportReason.html">ReportReason</a></li><li><a href="module-ReportSpecificUser.html">ReportSpecificUser</a></li><li><a href="module-ReportSubmitted.html">ReportSubmitted</a></li><li><a href="module-ReportUserPopup.html">ReportUserPopup</a></li><li><a href="module-SafetyPrivacy.html">SafetyPrivacy</a></li><li><a href="module-Schedule.html">Schedule</a></li><li><a href="module-SentMessagesTable.html">SentMessagesTable</a></li><li><a href="module-SidebarComponent.html">SidebarComponent</a></li><li><a href="module-SignupInfo.html">SignupInfo</a></li><li><a href="module-SocialLinksSection.html">SocialLinksSection</a></li><li><a href="module-SocialMediaModal.html">SocialMediaModal</a></li><li><a href="module-SocialUsernameModal.html">SocialUsernameModal</a></li><li><a href="module-Socialmodal.html">Socialmodal</a></li><li><a href="module-SubjectMessage.html">SubjectMessage</a></li><li><a href="module-The%2520Banned%2520component..html">The Banned component.</a></li><li><a href="module-The%2520ForgotPass%2520component..html">The ForgotPass component.</a></li><li><a href="module-The%2520ForgotUser%2520component..html">The ForgotUser component.</a></li><li><a href="module-The%2520ResetPass%2520component..html">The ResetPass component.</a></li><li><a href="module-The%2520profile%2520page%2520component..html">The profile page component.</a></li><li><a href="module-The%2520profile%2520sidebar%2520component..html">The profile sidebar component.</a></li><li><a href="module-The%2520rendered%2520Login%2520component..html">The rendered Login component.</a></li><li><a href="module-The%2520rendered%2520LoginPage%2520component..html">The rendered LoginPage component.</a></li><li><a href="module-The%2520rendered%2520Post%2520component..html">The rendered Post component.</a></li><li><a href="module-The%2520rendered%2520Rules%2520component..html">The rendered Rules component.</a></li><li><a href="module-The%2520rendered%2520UserMessage%2520component..html">The rendered UserMessage component.</a></li><li><a href="module-The%2520rendered%2520content%2520details%2520of%2520the%2520post..html">The rendered content details of the post.</a></li><li><a href="module-Threads.html">Threads</a></li><li><a href="module-ToMessage.html">ToMessage</a></li><li><a href="module-TopComms.html">TopComms</a></li><li><a href="module-TopCommunities.html">TopCommunities</a></li><li><a href="module-TypeUsername.html">TypeUsername</a></li><li><a href="module-UnfollowUser.html">UnfollowUser</a></li><li><a href="module-UnmarkAsNSFW.html">UnmarkAsNSFW</a></li><li><a href="module-UnmodderatedPosts.html">UnmodderatedPosts</a></li><li><a href="module-UserFunctions.html">UserFunctions</a></li><li><a href="module-UserNameMentions.html">UserNameMentions</a></li><li><a href="module-UserNameMentionsCom.html">UserNameMentionsCom</a></li><li><a href="module-UsernameInfo.html">UsernameInfo</a></li><li><a href="module-UsersProfilePage.html">UsersProfilePage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AccountPreferences">AccountPreferences</a></li><li><a href="global.html#ChangePass">ChangePass</a></li><li><a href="global.html#CommunityBody">CommunityBody</a></li><li><a href="global.html#CommunityHeader">CommunityHeader</a></li><li><a href="global.html#DeleteButton">DeleteButton</a></li><li><a href="global.html#Disconnect">Disconnect</a></li><li><a href="global.html#DropDown">DropDown</a></li><li><a href="global.html#Email">Email</a></li><li><a href="global.html#EmailButton">EmailButton</a></li><li><a href="global.html#GeneratePass">GeneratePass</a></li><li><a href="global.html#Google">Google</a></li><li><a href="global.html#Listing">Listing</a></li><li><a href="global.html#Titles">Titles</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Sat May 11 2024 19:53:28 GMT+0300 (Eastern European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
